name: Build React Project

on:
  push:
    branches:
      - frontend-deploy

jobs:
  build:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./frontend/

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: 16

      - name: Install dependencies
        run: npm ci

      - name: Add Environment Variables
        run: |
          echo "REACT_APP_GOOGLE_MAPS_API_KEY=${{ secrets.REACT_APP_GOOGLE_MAPS_API_KEY }}" > .env

      - name: Build
        run: npm run build

      - name: Upload build artifacts
        uses: actions/upload-artifact@v2
        with:
          name: build-artifacts
          path: frontend/deploy
  deploy:
      name: Deploy
      needs: build
      runs-on: ubuntu-latest
      defaults:
        run:
          working-directory: ./frontend/
        
      steps:
        - name: Checkout code
          uses: actions/checkout@v2
        
        - name: Download build artifacts
          uses: actions/download-artifact@v2
          with:
            name: build-artifacts
            path: frontend/deploy
  
        - id: 'auth'
          uses: 'google-github-actions/auth@v1'
          with:
            credentials_json: '{"type": "service_account", "project_id": "ecotransit-frontend", "private_key_id": "48d891a3492c8d1358060038e3a9093737a40ed8", "private_key": "-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDBtyqdMStjVb1U\noyzYfsu595KSaaGLB+AjWX0YK8hCf/xytxv1KDoLKQG4yZFT1Ir5rQEbTeYbD7GP\nGcaxTqAScZ6pnx7ppCl6+LXQR+2XnxDC2x6aanrG2uRtNhzqC+L7MO0s7RG1GdJf\nN5SK3J3KR3LuNKaW3/pJGjr5V9jck/rN+/uKxAKXUTEjppby36e9z1p+Zr55DgSb\n3qpTdS8mA9biL/aGVg35K2TEVX8ejDiHxpMtmxHXphR04I2GQXuiA0/qaJQS3y82\naKV+BGbnRzKvE3MQdbCFX2hL58+eufsxds7x84aiiunmKQkd35YdSsdWcqMj5XNi\n+zT29u03AgMBAAECggEAGzSSM4lYQpckA+L2xWDpU7DFUPKs0U3F2LEUtHRRp6U5\n2xKERqXjoPWdXEpSsqdC7VWythb2ng5SLXq9QOF98ZkrYz8JpF59xNtxDVNMtuKM\nBBGp9p3FqG/NbNkQrn4E3qo8ZPbWacy6kszHe8kIEASAy5txWfcSu3mHlsUTm8ae\nAPSrLQ1+cn7987dzQuabwAgouANqforUvjmuymcjZBjMwh9qnwEAD9MjRBJZpEB/\nhBSkvmOAxZWLBTrfN8PKenV+2i28jfellqs6WKvG5xnQNbAp0Kd67ZNN9qdRmRpJ\njQO36kcoVVsPz5pwHG73ATRTsUljE1wxL1GQt94MAQKBgQDg5qooXmxJ89wAfqSn\n965wF7BIAA2MdYQ6sqOimFxA5IhQpNJuu8C5MLjfLlqvWRDEGsScMAiIbzakoPus\n13wSvc82WwRmqwwoq9oAQLkE9/kG7KtnmN2owPWtdCEXl7cOB3sdMN6KEayHDU4S\n1XgcnCGZuc0RB3MM7nIbtDW3twKBgQDcgI5YL/7XdOmpnaAq/npZnqt01ssNPrCG\nkmIp/sxyq/L9UEYlX61G9t0E4nqY2Y9gRbrZbGBiNzIeMzATAiEiLml3W6QS0tjS\nvihDANLK/dwnGbtjq6Ap5Ln1Tx5FMxJtrx8MQtUNkuNcNXgQPKMDH5uiuDVNqvx0\nJz9VvoF2gQKBgFd6AMdQ6sfc/T6IA919XjElVaC7vIlckEEQiMtOfduTyF2trlf5\n2V1u0QmmCwnXF8lfLAggOsFumI9yOlIhQpY7k+RthIm2kDUlmtasVgrTtN33ojfa\nYqUn4KdF2zVFAqOHT2CsSHLlqviguTRkKaLfK8aSWWv9PMfT2zhhYN+DAoGBAISA\npAkOXl9um/MXC2aKoU81b+a4JDCDWWSklmSR/p1yAoSCNoTC58dbFRmYVv9+zQ+X\nF18MJycd7/oB3IOvpeV6aloVMZU2KqEJL/yDhCgDQMYmSlrsiURjc/ObZZ9Dv3E1\n6LxfdNPBTurcHpfzOCnqVoYDl9RiSW4rH34RCo8BAoGAd3vNgcdTs/99y3Nc1MIJ\nyKqCiRdQwLXYOJS5cw009/03OPhNwD4rugDZd1x/s5deoCZSIpVnctjPCJuqGXiv\nMaw6BKGVPnL7pyXHLwqALS2RCx3vXVDVCr7PS0eSB1+l7MdfM7OkJMK8xDBFjo8r\n+4kj7/QIbcEJCj7bMQMfFjc=\n-----END PRIVATE KEY-----\n", "client_email": "ecotransit-frontend@appspot.gserviceaccount.com", "client_id": "115618096129175847570", "auth_uri": "https://accounts.google.com/o/oauth2/auth", "token_uri": "https://oauth2.googleapis.com/token", "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs", "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/ecotransit-frontend%40appspot.gserviceaccount.com", "universe_domain": "googleapis.com"}'
        - name: 'Set up Cloud SDK'
          uses: 'google-github-actions/setup-gcloud@v1'
          with:
            version: '>= 363.0.0'
        - name: Deploy
          run: |
            gcloud app deploy deploy/

